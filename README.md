# PAM_GEMs
Integrating chlorophyll fluorescence data into genome-scale models of metabolism

This repository contains a series of jupyter notebooks to recreate the results presented in the manuscript titled:

**_Integration of physiologically relevant photosynthetic energy flows into whole genome models of light-driven metabolism_**

Authors: Jared T. Broddrick1,2, Maxwell A. Ware3, Denis Jallet3, Bernhard O. Palsson2 and Graham Peers3
1. Division of Biological Sciences, University of California, San Diego, La Jolla, CA
2. Department of Bioengineering, University of California, San Diego, La Jolla, CA
3. Department of Biology, Colorado State University, Fort Collins, CO

Instructions for running code associated with the manuscript:

"Integration of physiologically relevant photosynthetic energy flows into whole genome models of light-driven metabolism"

The folder structure is broken out by the major categories of the manuscript.

All code is distributed as Jupyter Notebooks written in Python.
Dependencies:
jupyter notebook (includes ipython notebook): 
	https://jupyter.org/
cobrapy: 
	https://opencobra.github.io/cobrapy/
pandas: 
	https://pandas.pydata.org/
numpy: 
	https://numpy.org/
csv: 
	pip install csv
matplotlib:
	https://matplotlib.org/
seaborn:
	https://seaborn.pydata.org/
scipy:
	https://scipy.org/
openpyxl:
	conda install -c anaconda openpyxl

Some folders have a subfolder called 'fcns' which contains a .py file called 'modeling_functions.py' containing a series of functions used to generate outputs. This is mostly to decrease how "busy" the cells are in the Jupyter Notebooks. However, much of the methodology is captured in these functions.

**Note: the 'modeling_function.py' file from different folders are NOT the same. They are specific for that parent folder. 

1) Cell physiology: cell dimensions, growth rates, and chlorophyll content.
	- From the menu bar at the top, select 'Cell' -> 'Run All' 
	- Raw data will be read in from local files and the analysis used will be recapitulated.

2) Photophysiology: absorption coefficients (a*cell), O2 evolution curves, PAM vs PAR curves, adn PAM vs QF curves. 
** Note, this is an example using one HL culture to demonstrate the method and is not the comprehensive dataset used in the study **
	- From the menu bar at the top, select 'Cell' -> 'Run All' 
	- Raw data will be read in from local files and the analysis used will be recapitulated.

** If you get an error stating 'UnicodeDecodeError: 'utf-8' codec can't decode byte...' in the second cell of the "Simultaneous oxygen evolution and PAM fluorimetry" section, change the following:

	O2_data = pd.read_csv(item, sep='\t', skiprows=13, usecols=[2,4])
to
	O2_data = pd.read_csv(item, sep='\t', skiprows=13, usecols=[2,4], encoding = "ISO-8859-1")
	

3) Genome-scale Modeling
	3A) Builds the model with updates to the previous P. tricornutum GEM. Adds PAM pseudo-reactions, D1 damage
	reactions, builds a low light (LL) and a high ligh (HL) model for use in downstream simulations.
 		- From the menu bar at the top, select 'Cell' -> 'Run All'
		- Two models will be built, one for low light simulations and one for high light simulations. 
		They differ in their biomass composition.

	3B) Simulates and returns growth rates at different parameter combinations (Figure 2), and growth rates with 
	different constraints (Table 2).
		- From the menu bar at the top, select 'Cell' -> 'Run All'
		- Figure 2 and the data for Table 2 in the manuscript will be recreated in the notebook.

**Note, the model files 'HL_base_iLB1035.json' and 'LL_base_iLB1035.json' that are generated by this notebook need to be copied to the subsequent folders**

4) Cross-compartment electron shuttles: 
	- Copy the model files 'HL_base_iLB1035.json' and 'LL_base_iLB1035.json' from 3_Genome-scale_Modeling to 4_Cross_compartment_electron_shuttles.
	- From the menu bar at the top, select 'Cell' -> 'Run All'
	- Figure 4 subpanels A and B from the manuscript will be generated.

5) Bioengineering: 
	****
	This is broken up into two separate notebooks. The simulations required to generate Figure 6 can take up to ~17 GB above normal backgorund system RAM requirements. By breaking it into two notebooks, the hope is systems with 16GB RAM can run the simulations.

	However, if there is a memory issue, writing the output to a csv file and then restarting the kernal for the next simulation can be a work around. The final dataFrame used for poltting can then be built by importing all the csv files.
	****
	- Copy the model files 'HL_base_iLB1035.json' and 'LL_base_iLB1035.json' from 3_Genome-scale_Modeling to 5_Bioengineering.
	
	5A) This recapitulates Table 3, Figure 5 and Figure 6 A,B from the manuscript.
		- From the menu bar at the top, select 'Cell' -> 'Run All'
		- Total memory usage: ~6 GB above background system requirements.

	5B) This recapitulates Figure 6 C,D from the manuscript.
	** Note, the inoculation densities used here are more sparse than in the manuscript to save comuptation time and resources.
		- From the menu bar at the top, select 'Cell' -> 'Run All'
		- Total memory usage: ~16 GB ABOVE background system requirements.

